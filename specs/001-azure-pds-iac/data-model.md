# Data Model: Azure PDS Infrastructure Automation

## DeploymentParameters
- **Fields**:
  - `namePrefix` (string, required): Prefix for resource naming; alphanumeric with length <= 12.
  - `location` (string, optional): Azure region; defaults to resource group location.
  - `pdsHostname` (string, required): Custom domain or host for the PDS endpoint.
  - `pdsImageTag` (string, required): Tag of the PDS container image.
  - `dnsZoneName` (string, optional): Public DNS zone to update; empty to skip.
  - `dnsRecordName` (string, optional): Relative record for PDS host when DNS is managed by template.
  - `fileShareQuotaGiB` (int, optional): Size for Azure Files share (default 256 GiB).
  - `maintenanceWindow` (string, optional): Backup schedule window (ISO day/time description).
- **Relationships**: Provides inputs required by the main Bicep template.
- **Validation Rules**:
  - `namePrefix` must avoid azure reserved words; ensure unique across storage accounts.
  - `pdsHostname` must be valid FQDN.
  - `maintenanceWindow` must parse to start time + timezone accepted by Automation schedule.

## SecretInventory
- **Fields**:
  - `pdsJwtSecretName` (string, required): Key Vault secret name for JWT secret.
  - `pdsAdminPasswordSecretName` (string, required).
  - `pdsPlcRotationKeySecretName` (string, required).
  - `smtpSecretName` (string, required).
  - `storageAccountKeySecretName` (string, derived): Generated by template for automation runbooks.
- **Relationships**: Referenced by Container Apps environment and Automation runbook.
- **Validation Rules**:
  - Secret names limited to alphanumeric and hyphen.
  - Operator must create secrets prior to enabling Container App revision.

## BackupSchedule
- **Fields**:
  - `frequency` (enum: Daily): Confirmed daily execution cadence.
  - `startTime` (string, required): Start time within maintenance window (UTC).
  - `timeZone` (string, required): Timezone identifier supported by Automation schedules.
  - `retentionDays` (int, default 30): Snapshot retention window.
- **Relationships**: Bound to Automation schedule and runbook configuration.
- **State Transitions**:
  - `Scheduled` → `Running` → `Completed` (success) or `Failed` (trigger alert).
- **Validation Rules**:
  - `startTime` must align with defined maintenance window.
  - `retentionDays` >= 7 to ensure weekly coverage.

## ResourceOutputs
- **Fields**:
  - `containerAppFqdn` (string): Public endpoint for PDS.
  - `storageAccountId` (string): Resource ID for Azure Files backups.
  - `automationRunbookId` (string): Resource ID for backup runbook.
- **Relationships**: Provided to quickstart and post-deployment validation steps.
- **Validation Rules**:
  - Values must populate after successful deployment to guide operators.
